<Window x:Class="Test2.Window1"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Test2" 
        mc:Ignorable="d"
        Title="Window1" Height="450" Width="800">
    
    <DockPanel>
        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <ProgressBar Width="250" Height="16"
Minimum="0" Maximum="100"
Value="{Binding ProgressPercent}"/>
            </StatusBarItem>
            <StatusBarItem Content="{Binding StatusText}"/>
        </StatusBar>


        <StackPanel Orientation="Horizontal" Margin="10" DockPanel.Dock="Top" >
            <TextBox Width="420" Text="{Binding InputPath, UpdateSourceTrigger=PropertyChanged}"/>
            <Button Content="Browse" Command="{Binding BrowseInputCommand}"/>
            <Button Content="Import → Stage" Command="{Binding ImportCommand}"/>
            <Button Content="Export Excel" Command="{Binding ExportCommand}"/>
            <Button Content="Cancel" Command="{Binding CancelCommand}"/>
        </StackPanel>


        <Grid Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>


            <!-- Filter/Search (đẩy xuống SQLite) -->
            <StackPanel Orientation="Horizontal" >
                <TextBox Width="180"  Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}"/>
                <Button Content="Apply" Command="{Binding ApplyFilterCommand}"/>
            </StackPanel>


            <!-- DataGrid phân trang + ảo hoá -->
            <DataGrid Grid.Row="1"
                        ItemsSource="{Binding CurrentPageItems}"
                        AutoGenerateColumns="False"
                        CanUserAddRows="False"
                        IsReadOnly="False"
                        EnableRowVirtualization="True"
                        VirtualizingPanel.IsVirtualizing="True"
                        VirtualizingPanel.VirtualizationMode="Recycling"
                        ScrollViewer.CanContentScroll="True"
                        ScrollViewer.ScrollChanged="{Binding OnScrollChanged}" >
                <!-- TODO: Khai báo cột cụ thể theo schema của bạn -->
                <DataGrid.Columns>
                    <DataGridTextColumn Header="#" Binding="{Binding RowNumber}" Width="60" IsReadOnly="True"/>
                    <DataGridTextColumn Header="ColA" Binding="{Binding ColA}"/>
                    <DataGridTextColumn Header="ColB" Binding="{Binding ColB}"/>
                    <!-- ... -->
                </DataGrid.Columns>
            </DataGrid>


            <!-- Paging -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" 
                        HorizontalAlignment="Right"  Margin="0,8,0,0">
                <TextBlock Text="Page:" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding PageIndex}" VerticalAlignment="Center"/>
                <Button Content="Prev" Command="{Binding PrevPageCommand}"/>
                <Button Content="Next" Command="{Binding NextPageCommand}"/>
                <TextBlock Text="/"/>
                <TextBlock Text="{Binding TotalPages}"/>
            </StackPanel>
        </Grid>
    </DockPanel>
</Window>
